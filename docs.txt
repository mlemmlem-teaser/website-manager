import { app, auth, dbFireStore,} from "../../../../contains/config.firebase.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
import { setDoc, doc,} from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
import { role } from "../../../../contains/index.js";

// querySelector: dùng để lấy element trong html ~~ document.getElementById
const form = document.querySelector(".form_login");
async function registerUser(e) {
  e.preventDefault();
  const { target } = e; //này là user
  const email = target.email.value;
  const password = target.password.value;
  const name = target.name.value;
  try {
    //thông tin đăng nhập
    const userCredential = await createUserWithEmailAndPassword( 
      auth,
      email,
      password
    );
    const { user } = userCredential;
    if (user) {
      target.email.value = "";
      target.password.value = "";
      target.name.value = "";
    }
    try {
      await setDoc(doc(dbFireStore, role.user, user.uid), { //tạo dữ liệu trong db của bảng admin hoặc user
        email,
        name,
        id: user.uid,
        status: {
          role: "user",
          active: true,
        },
      });
    } catch (error) {
      alert(error.message);
    }
  } catch (error) {
    alert(error.message);
  }
}

form.addEventListener("submit", async (e) => {
  await registerUser(e);
});

















// import { role } from "../../../contains.js";

import { dbFireStore } from "../../../contains/config.firebase.js";
import modalHtml from "../../../contains/modal.js";
import { collection, getDocs, setDoc, doc,} from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

const modal = document.querySelector(".modal");
const container = document.querySelector(".container");
const table = document.querySelector(".table");


//hàm lấy tất cả user rồi nhét vào bảng, tạo bảng
const getUser = async () => {
  const querySnapsot = await getDocs(collection(dbFireStore, "users")); //lấy tài liệu từ db của bảng users
  querySnapsot.docs.forEach((item, index) => { //lấy mỗi user từ querySnapsot và vị trí của nó
    const data = item.data(); //object chứa thông tin user
    const { name, email, id, status } = data; 
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${name}</td>
      <td>${email}</td>
      <td>${
        status.active
          ? "<p style='color: green'>active</p>"
          : "<p style='color: red'>unactive</p>"
      }</td>
    `;
    const column = document.createElement("td");
    const btn = document.createElement("button");
    column.appendChild(btn);
    tr.appendChild(column);
    btn.innerText = "Delete";
    btn.addEventListener("click", () => {
      onDelete(id);
    });
    table.appendChild(tr);
  });
};

window.onload = getUser();

//hàm tạo lại cái bảng sau khi xóa user
function onDelete(id) {
  modal.innerHTML = modalHtml();
  modal.style.display = "block";
  const btn_cancel = document.querySelector(".btn_cancel");
  const btn_confirm = document.querySelector(".btn_confirm");
  container.style = `
    position: relative;
    z-index: 1;
    opacity: 0.5; 
    background-color: #000;
  `;

  //ẩn cái modal khi cancel
  const handelHiddenModal = () => {
    modal.style.display = "none";
    container.style = "";
  };


//ẩn cái modal khi confirm
  const handelDeleteUser = async () => {
    const dref = doc(dbFireStore, "users", id); //lấy 1 user từ db
    modal.style.display = "none";
    container.style = "";
    try {
      await setDoc(dref, //user được chọn để xóa
        {status: {active: false,},} //đặt lại status thành false
        ,{ merge: true }); //options
      getUser(); //tạo lại cái bảng sau khi xóa
    } catch (error) {
      console.log(error);
    }
  };
  btn_confirm.addEventListener("click", handelDeleteUser);
  btn_cancel.addEventListener("click", handelHiddenModal);
}















import { role } from "../../../contains/index.js";

onAuthStateChanged(auth, async (user) => { //khi đăng nhập lấy tham số auth(người đang đăng nhập)
  if (user) {
    const uid = user.uid;
    const docRef = doc(dbFireStore, "users", uid); //thông tin user đó
    const docSnap = await getDoc(docRef); //lấy thông tin cho vào biến docSnap
    if (docSnap.exists()) {
      const data = docSnap.data(); //lấy data cần dùng từ docSnap
      data.status.role === role.admin
        ? (window.location.href = "../../Admin/Dashboard/dashboard.html")
        : (window.location.href = "../../Home/home.html");
    } else {
      // docSnap.data() will be undefined in this case
      console.log("No such document!");
    }
  } else {
    // User is signed out
    // ...
  }
});












const role = {
  admin: "admin",
  user: "users",
};

const getData = async (url) => {
  const data = await fetch(`${url}`);
  return data;
};

export { getData, role };

















const index = button.dataset.index;
        get(ref(dbRealTime, "products/" + dataArray[index].id)).then((data) => {
          if (data.exists()) {
            console.log(data.val());
          } else {
            console.log("No data available");
          }
        }
        )

import { dbRealTime } from "config-firebase.js";
import { dbFireStore, Auth } from "config-firebase.js";
import { collection, getDocs, getDoc, doc,updateDoc,setDoc} from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
1715696446734-1e7010
: 
{description: 'báo nhì thế giới(sau Hưng)', id: '1715696446734-302bc7', imageurl_: '/Assets/Images/Bảo.jpg', nameProduct: 'Báo phó', price: '123456'}
1715696514080-b58098
: 
{description: 'báo nhất thế giới', id: '1715696514080-26bb19', imageurl_: '/Assets/Images/Hưng.jpg', nameProduct: 'Báo trưởng', price: '123456'}
1715842817711-0dd768
: 
{description: 'Hàng nóng đó chơi cẩn thận', id: '1715842817712-debbb8', imageurl_: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTjPvPtX5yUh1SKQTCHpPEinpQ7hJ0q8AbRFQ&s', nameProduct: 'Sokka Bommerang', price: '200'}
1715843450834-584af5
: 
{description: 'MlemMlem', id: '1715843450835-a60717', imageurl_: 'https://lzd-img-global.slatic.net/g/p/7bec8bb3e7993fc4aa505f8998f4d61e.jpg_400x400q75.jpg_.webp', nameProduct: 'Hutao Cosplay', price: '250'}
1715843481562-762afa
: 
{description: 'MlemMlem', id: '1715843481562-c42dda', imageurl_: 'https://lzd-img-global.slatic.net/g/p/fffb343e8bcf5cd9e65d40c506bd6f7f.jpg_400x400q75.jpg_.webp', nameProduct: 'Yae Miko Cosplay', price: '250'}
1715843511368-ff0ee0
: 
{description: 'MlemMlem', id: '1715843511368-5ec893', imageurl_: 'https://lzd-img-global.slatic.net/g/p/0e5549f3edd6a248df7f1d7a7a028e2d.jpg_400x400q75.jpg_.webp', nameProduct: 'Klee Cosplay', price: '290'}
1715843559612-008c2e
: 
{description: 'Mấy chị mê lắm', id: '1715843559612-610d1a', imageurl_: 'https://lzd-img-global.slatic.net/g/p/076c5ea1dd9b88c638121a4b7b333052.jpg_400x400q75.jpg_.webp', nameProduct: 'Razor gối Cover', price: '40'}
1715843611241-479f3c
: 
{description: 'Mấy anh mê lắm', id: '1715843611241-29927e', imageurl_: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD…mmf7T24D7q8B8+dSelKxNtu2TFKUrgFKUoBSlKAUpSgP/2Q==', nameProduct: 'Furina Cosplay', price: '300'}
1715843653339-cd78f3
: 
{description: 'Mấy anh báo mê lắm', id: '1715843653339-7b83a3', imageurl_: 'https://lzd-img-global.slatic.net/g/p/3c22383144184e9e6b4965687ad85a19.jpg_400x400q75.jpg_.webp', nameProduct: 'Móc khóa phóng lợn', price: '76'}
1715843693194-036602
: 
{description: 'Mấy anh trẻ trâu mê lắm', id: '1715843693194-8d38cb', imageurl_: 'image/7.png', nameProduct: 'Kamen Rider Armor', price: '200'}
1715843772034-af9a4e
: 
{description: 'Mấy anh trẻ trâu mê lắm', id: '1715843772034-7fb17e', imageurl_: 'https://down-vn.img.susercontent.com/file/sg-11134201-23030-0j91gyhfdyovde', nameProduct: 'Hộp bút dạ quang', price: '200'}
